# Логирование

Логирование нужно собирать со всех бекенд сервисов. Логи с уровнем INFO:
- Все запросы и ответы между сервисами
- Все запросы и ответы во внешние системы(которых нет, поэтому не актуально)
- Изменение состояния заказа, такие как создание, обработка, расчет, и т.д. по статусной модели

Также необходимо включить логирование баз данных на уровне DDL, такие как создание схем или таблиц, а также на модицикацию данных таблиц.
Логов будет много, поэтому можно поставить ротеншн в 1 неделю и складировать данные в S3.

### 1. Мотивация

Учитывая, что в системе происходит потеря сообщений, логирование даст возможность наблюдения на прохождение тех или иных участков кода и будет возможность увидеть цепочку прохождения заказов. Если еще в логи докинуть trace id с помощью elastic-ecs пакетов и приведения логирования в ecs формат, то будет вообще песня. Сможем по трейсам сразу искать логи этого запроса.

Логирование поможет:
- Повысить наблюдаемость системы через анализ логов
- Поможет проанализировать изменение состояния заказа
- Позволит выявить потенциальные проблемные места в системе и некорректное изменение состояния заказа

### 2. Предлагаемое решение

Решение предлагается реализовать с помощью того же APM агента и APM сервера, все будет проходить аналогично с трейсингом. Политики безопасности будут такие же как и с трейсингом.

```markdown
[Component diagram]()
```

### 3. Система анализа логов

Есть возможность настройки wazuh агента и сервера для анализа безопасности системы, однако в данный момент это нецелесообразно в виду отсутствия капасити.
Предлагается настроить алертинг по логам баз данных с уровнем логирования ниже warning, такие как error, fatal и другие, по которым требуется срочное внимание со стороны разработки.

На уровне приложений имеет смысл внедрения алертинга по логам с уровнем Error.
Через логи искать аномалии бессмысленно в рамках нашей системы, для этого существуют метрики. В случае ддос атак мы сможем это выяснить по метрике "Number of requests (RPS) for internet shop API". Также разумно внедрение WAF, например cloudflare для защиты от подобного рода атак.
